<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Razorpay Payment</title>
  <style>
    .message { padding: 10px; margin: 10px 0; }
    .error { background: #ffebee; color: #c62828; }
    .success { background: #e8f5e9; color: #2e7d32; }
  </style>
</head>
<body>
  <h1>Razorpay Payment Gateway Integration</h1>
  <div id="message"></div>
  <form id="payment-form">
    <label for="amount">Amount (INR):</label>
    <input type="number" id="amount" name="amount" required min="1">
    <button type="button" onclick="payNow()">Pay Now</button>
  </form>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    function showMessage(text, type) {
      const msgDiv = document.getElementById('message');
      msgDiv.className = `message ${type}`;
      msgDiv.textContent = text;
    }

    async function payNow() {
      try {
        const amount = document.getElementById('amount').value;
        if (!amount || amount <= 0) {
          showMessage('Please enter a valid amount', 'error');
          return;
        }

        // Create order
        const response = await fetch('/create-order', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ amount })
        });

        if (!response.ok) throw new Error('Failed to create order');

        const order = await response.json();

        const options = {
          key: order.key,
          amount: order.amount,
          currency: order.currency,
          name: 'Your Company Name',
          description: 'Purchase Description',
          order_id: order.id,
          handler: async function (response) {
            console.log(response);
            try {
              const verifyResponse = await fetch('/verify-payment', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(response)
              });

              const data = await verifyResponse.json();
              if (data.success) {
                showMessage('Payment successful!', 'success');
              } else {
                showMessage('Payment verification failed', 'error');
              }
            } catch (err) {
              showMessage('Payment verification failed: ' + err.message, 'error');
            }
          },
          prefill: {
            name: 'test',
            email: '91287472132',
            contact: 'ajiofeji'
          },
          theme: {
            color: '#3399cc'
          }
        };

        const rzp = new Razorpay(options);
        rzp.on('payment.failed', function (response) {
          showMessage('Payment failed: ' + response.error.description, 'error');
        });
        rzp.open();

      } catch (error) {
        showMessage('Error: ' + error.message, 'error');
      }
    }
  </script>
</body>
</html>